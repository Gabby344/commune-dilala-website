<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Commune de Dilala</title>

  <style>
    /* ===== Reset & Base ===== */
    :root{
      --brand:#0b3b66;
      --accent:#ffb703;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f4f7fc;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:#0b1721;
      -webkit-font-smoothing:antialiased;
      line-height:1.45;
    }
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* ===== Navbar ===== */
    .navbar{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 28px; background:linear-gradient(90deg,var(--brand), #003a5a);
      color:white; box-shadow:0 6px 18px rgba(2,10,23,0.12);
    }
    .logo{font-weight:700; font-size:18px; letter-spacing:0.4px}
    .nav-links{display:flex; gap:18px; align-items:center}
    .nav-links a{color:rgba(255,255,255,0.95); padding:8px 10px; border-radius:8px}
    .nav-links a:hover{background:rgba(255,255,255,0.06)}

    .btn-primary{
      background:var(--accent); color:#07203b; padding:8px 12px; border-radius:10px; font-weight:600;
      box-shadow:0 6px 12px rgba(11,59,102,0.08);
    }

    /* ===== Hero ===== */
    .hero{
      padding:80px 24px;
      display:grid;
      grid-template-columns: 1fr;
      gap:24px;
      align-items:center;
      text-align:center;
      background:
        radial-gradient(circle at 10% 10%, rgba(255,183,3,0.06), transparent 8%),
        linear-gradient(180deg, rgba(11,59,102,0.06), transparent 40%);
    }
    .hero .container{max-width:1100px;margin:0 auto}
    .hero h1{font-size:34px;margin:0 0 8px;color:var(--brand)}
    .hero p{margin:0 0 18px;color:var(--muted)}

    /* ===== Layout sections ===== */
    main{max-width:1200px;margin:28px auto;padding:0 18px}
    section{background:transparent;margin-bottom:26px;padding:0}
    .card-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:18px;
      margin-top:16px;
    }
    .card{
      background:var(--card); padding:16px; border-radius:var(--radius);
      box-shadow:0 6px 20px rgba(2,10,23,0.06);
    }
    .card h3{margin:0 0 8px;font-size:16px}
    .muted{color:var(--muted);font-size:14px}

    /* ===== Forms ===== */
    form{display:flex;flex-direction:column;gap:10px}
    input[type="text"], input[type="email"], textarea{
      border:1px solid #e6edf6; padding:10px;border-radius:8px;background:#fff;
    }
    textarea{min-height:100px; resize:vertical}
    .row{display:flex;gap:12px}
    .row .col{flex:1}

    /* ===== Footer ===== */
    footer{padding:24px;text-align:center;color:var(--muted); font-size:14px}

    /* ===== Admin toggle small ===== */
    .admin-toggle{position:fixed;right:18px;bottom:18px;z-index:60}
    .admin-panel{
      position:fixed; right:18px; bottom:72px; width:360px; max-width:95vw;
      background:white;padding:12px;border-radius:12px;box-shadow:0 12px 32px rgba(2,10,23,0.14);
      display:none; flex-direction:column; gap:8px; z-index:60;
    }

    /* Responsive */
    @media(min-width:900px){
      .hero{grid-template-columns:1fr 420px; text-align:left; padding:80px 32px}
      .hero .left{padding-right:30px}
      .hero .card-cta{background:white;padding:18px;border-radius:14px;box-shadow:0 10px 30px rgba(2,10,23,0.06)}
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">Commune de Dilala</div>
    <div class="nav-links" id="nav">
      <a href="#home">Accueil</a>
      <a href="#services">Services</a>
      <a href="#projets">Projets</a>
      <a href="#actualites">Actualités</a>
      <a href="#evenements">Événements</a>
      <a href="#contact" class="btn-primary">Contact</a>
    </div>
  </nav>

  <header id="home" class="hero">
    <div class="container left">
      <h1>Bienvenue à la Commune de Dilala</h1>
      <p>Transparence • Services accessibles • Projets pour la communauté — tout sur une seule page.</p>

      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <a class="btn-primary" href="#services">Nos services</a>
        <a style="padding:8px 12px;border-radius:10px;background:#fff;color:var(--brand);font-weight:600" href="#projets">Voir les projets</a>
      </div>
    </div>

    <div class="container card-cta" style="margin-top:12px;">
      <h3 style="margin:0 0 6px">Mot du Maire</h3>
      <p class="muted" style="margin:0 0 8px">« Bienvenue sur le portail de la commune — votre voix compte. »</p>
      <div class="muted" style="font-size:13px">Adresse : Bureau communal — Dilala | Téléphone : +243 000 000</div>
    </div>
  </header>

  <main>

    <!-- Services -->
    <section id="services">
      <h2>Nos services</h2>
      <div id="services-grid" class="card-grid">
        <!-- Chargé dynamiquement -->
      </div>
    </section>

    <!-- Projets -->
    <section id="projets">
      <h2>Projets en cours</h2>
      <div id="projets-grid" class="card-grid"></div>
    </section>

    <!-- Actualités -->
    <section id="actualites">
      <h2>Actualités</h2>
      <div id="actualites-grid" class="card-grid"></div>
    </section>

    <!-- Événements -->
    <section id="evenements">
      <h2>Événements à venir</h2>
      <div id="evenements-grid" class="card-grid"></div>
    </section>

    <!-- Contact -->
    <section id="contact">
      <h2>Contactez la mairie</h2>
      <div class="card" style="max-width:800px;margin-top:12px">
        <form id="contact-form">
          <div class="row">
            <div class="col"><input type="text" id="contact-name" placeholder="Nom complet" required></div>
            <div class="col"><input type="email" id="contact-email" placeholder="Email" required></div>
          </div>
          <input type="text" id="contact-subject" placeholder="Objet" required>
          <textarea id="contact-message" placeholder="Votre message" required></textarea>
          <div style="display:flex;gap:8px;align-items:center">
            <button type="submit" class="btn-primary">Envoyer le message</button>
            <div id="contact-status" class="muted" style="font-size:13px"></div>
          </div>
        </form>
      </div>
    </section>

  </main>

  <footer>
    © <span id="year"></span> Commune de Dilala — Conçu pour la communauté.
  </footer>

  <!-- Admin quick panel (prototype) -->
  <div class="admin-toggle">
    <button id="open-admin" class="btn-primary">Admin</button>
  </div>
  <div class="admin-panel" id="admin-panel" aria-hidden="true">
    <strong>Admin rapide (prototype)</strong>

    <!-- Add Service -->
    <details open>
      <summary>Ajouter un service</summary>
      <form id="service-form">
        <input type="text" id="svc-title" placeholder="Titre du service" required>
        <input type="text" id="svc-desc" placeholder="Description" required>
        <button type="submit" class="btn-primary">Ajouter service</button>
        <div id="svc-status" class="muted"></div>
      </form>
    </details>

    <!-- Add Projet -->
    <details>
      <summary>Ajouter un projet</summary>
      <form id="projet-form">
        <input type="text" id="proj-title" placeholder="Titre du projet" required>
        <input type="text" id="proj-resume" placeholder="Résumé" required>
        <input type="text" id="proj-image" placeholder="URL image (optionnelle)">
        <button type="submit" class="btn-primary">Ajouter projet</button>
        <div id="proj-status" class="muted"></div>
      </form>
    </details>

    <!-- Add Actualité -->
    <details>
      <summary>Ajouter une actualité</summary>
      <form id="actu-form">
        <input type="text" id="actu-title" placeholder="Titre" required>
        <textarea id="actu-content" placeholder="Contenu" required></textarea>
        <button type="submit" class="btn-primary">Ajouter actualité</button>
        <div id="actu-status" class="muted"></div>
      </form>
    </details>

    <!-- Add Événement -->
    <details>
      <summary>Ajouter un événement</summary>
      <form id="event-form">
        <input type="text" id="ev-title" placeholder="Titre" required>
        <input type="text" id="ev-date" placeholder="Date (YYYY-MM-DD)" required>
        <textarea id="ev-desc" placeholder="Description" required></textarea>
        <button type="submit" class="btn-primary">Ajouter événement</button>
        <div id="ev-status" class="muted"></div>
      </form>
    </details>

    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="close-admin" style="flex:1;padding:8px;border-radius:8px">Fermer</button>
      <button id="clear-local" style="flex:1;padding:8px;border-radius:8px;background:#fee2e2">Clear local</button>
    </div>
  </div>

  <!-- ===== Firebase + App logic ===== -->
  <script type="module">
    // ------------------------
    // 1) Import Firebase (modular) from CDN
    // ------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // ------------------------
    // 2) Ta config Firebase (tu l'as fournie)
    // ------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyD3J0XRt50pJB77ooBC2f_MWYX0Kc2GXZY",
      authDomain: "projet-commune-dilala.firebaseapp.com",
      projectId: "projet-commune-dilala",
      storageBucket: "projet-commune-dilala.firebasestorage.app",
      messagingSenderId: "298637105374",
      appId: "1:298637105374:web:7c1af2177fd6a1586c4a4f"
    };

    // Initialize Firebase & Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ------------------------
    // 3) Helpers : Ajouter élément + afficher notification simple
    // ------------------------
    function el(q) { return document.querySelector(q) }
    function elAll(q) { return Array.from(document.querySelectorAll(q)) }
    function notify(elm, msg, ok=true){ elm.textContent = msg; elm.style.color = ok ? 'inherit' : '#b91c1c'; setTimeout(()=> elm.textContent = '', 3500) }

    // ------------------------
    // 4) RENDER fonctions pour collections
    // ------------------------
    function renderCards(containerSelector, docs, type){
      const container = el(containerSelector);
      container.innerHTML = '';
      if(docs.length === 0){
        container.innerHTML = '<div class="card"><div class="muted">Aucun contenu pour l\'instant.</div></div>';
        return;
      }
      docs.forEach(doc => {
        let html = '';
        if(type === 'service'){
          html = `<div class="card"><h3>${escapeHTML(doc.titre)}</h3><p class="muted">${escapeHTML(doc.description)}</p></div>`;
        } else if(type === 'projet'){
          html = `<div class="card">${doc.image ? `<img src="${escapeHTML(doc.image)}" alt="${escapeHTML(doc.titre)}" style="height:140px;object-fit:cover;border-radius:8px;margin-bottom:8px">` : ''}<h3>${escapeHTML(doc.titre)}</h3><p class="muted">${escapeHTML(doc.resume)}</p></div>`;
        } else if(type === 'actualite'){
          html = `<div class="card"><h3>${escapeHTML(doc.titre)}</h3><p class="muted">${escapeHTML(truncate(doc.contenu,120))}</p></div>`;
        } else if(type === 'evenement'){
          html = `<div class="card"><h3>${escapeHTML(doc.titre)}</h3><p class="muted">${formatDate(doc.date_event)} — ${escapeHTML(truncate(doc.description,120))}</p></div>`;
        }
        container.insertAdjacentHTML('beforeend', html);
      });
    }

    function escapeHTML(s=''){ return (''+s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m] }) }
    function truncate(s, n){ if(!s) return ''; return s.length>n ? s.slice(0,n)+'…' : s }
    function formatDate(d){
      if(!d) return '';
      // handle "YYYY-MM-DD" or Date object
      if(typeof d === 'string') return d;
      if(d.toDate) d = d.toDate();
      return d.toLocaleDateString('fr-FR');
    }

    // ------------------------
    // 5) Real-time listeners (Firestore)
    // ------------------------
    // services
    const servicesCol = collection(db, 'services');
    const qSvc = query(servicesCol, orderBy('created_at','desc'));
    onSnapshot(qSvc, snap => {
      const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderCards('#services-grid', docs, 'service');
    });

    // projets
    const projetsCol = collection(db, 'projets');
    const qProj = query(projetsCol, orderBy('created_at','desc'));
    onSnapshot(qProj, snap => {
      const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderCards('#projets-grid', docs, 'projet');
    });

    // actualites
    const actusCol = collection(db, 'actualites');
    const qAct = query(actusCol, orderBy('date_pub','desc'));
    onSnapshot(qAct, snap => {
      const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderCards('#actualites-grid', docs, 'actualite');
    });

    // evenements
    const evCol = collection(db, 'evenements');
    const qEv = query(evCol, orderBy('date_event','asc'));
    onSnapshot(qEv, snap => {
      const docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderCards('#evenements-grid', docs, 'evenement');
    });

    // ------------------------
    // 6) Submit handlers (add to Firestore)
    // ------------------------
    // Contact form
    el('#contact-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = el('#contact-name').value.trim();
      const email = el('#contact-email').value.trim();
      const subject = el('#contact-subject').value.trim();
      const message = el('#contact-message').value.trim();
      const status = el('#contact-status');
      try{
        await addDoc(collection(db,'contacts'), {
          name, email, subject, message, created_at: serverTimestamp()
        });
        notify(status, 'Message envoyé — merci !');
        el('#contact-form').reset();
      } catch(err){
        console.error(err);
        notify(status, 'Erreur lors de l\'envoi', false);
      }
    });

    // Service add
    el('#service-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const t = el('#svc-title').value.trim();
      const d = el('#svc-desc').value.trim();
      const s = el('#svc-status');
      try{
        await addDoc(collection(db,'services'), { titre: t, description: d, created_at: serverTimestamp() });
        el('#service-form').reset();
        notify(s, 'Service ajouté');
      }catch(err){ console.error(err); notify(s,'Erreur', false) }
    });

    // Projet add
    el('#projet-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const t = el('#proj-title').value.trim();
      const r = el('#proj-resume').value.trim();
      const img = el('#proj-image').value.trim() || '';
      const s = el('#proj-status');
      try{
        await addDoc(collection(db,'projets'), { titre: t, resume: r, image: img, created_at: serverTimestamp() });
        el('#projet-form').reset();
        notify(s,'Projet ajouté');
      }catch(err){ console.error(err); notify(s,'Erreur', false) }
    });

    // Actualité add
    el('#actu-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const titre = el('#actu-title').value.trim();
      const contenu = el('#actu-content').value.trim();
      const s = el('#actu-status');
      try{
        await addDoc(collection(db,'actualites'), { titre, contenu, date_pub: serverTimestamp(), created_at: serverTimestamp() });
        el('#actu-form').reset();
        notify(s,'Actualité ajoutée');
      }catch(err){ console.error(err); notify(s,'Erreur', false) }
    });

    // Evénement add
    el('#event-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const titre = el('#ev-title').value.trim();
      const date_event = el('#ev-date').value.trim(); // expect YYYY-MM-DD
      const description = el('#ev-desc').value.trim();
      const s = el('#ev-status');
      try{
        await addDoc(collection(db,'evenements'), { titre, date_event, description, created_at: serverTimestamp() });
        el('#event-form').reset();
        notify(s,'Événement ajouté');
      }catch(err){ console.error(err); notify(s,'Erreur', false) }
    });

    // ------------------------
    // 7) Admin toggles
    // ------------------------
    el('#open-admin').addEventListener('click', ()=> {
      el('#admin-panel').style.display = 'flex';
      el('#admin-panel').setAttribute('aria-hidden','false');
    });
    el('#close-admin').addEventListener('click', ()=> {
      el('#admin-panel').style.display = 'none';
      el('#admin-panel').setAttribute('aria-hidden','true');
    });
    el('#clear-local').addEventListener('click', ()=> {
      localStorage.clear(); alert('Local cleared');
    });

    // Footer year
    el('#year').textContent = new Date().getFullYear();

    // ------------------------
    // 8) Petit stockage local pour demo (optional)
    // ------------------------
    // (pour performance, on peut cacher le panel si on veut)
    // fin du module

  </script>
</body>
</html>
